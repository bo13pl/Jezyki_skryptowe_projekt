<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Poker Game</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .hidden { display: none; }
        .card { display: inline-block; width: 50px; height: 75px; border: 1px solid #000; text-align: center; line-height: 75px; margin: 5px; }
        .card span { display: block; margin-top: 30px; }
        .player-info { margin: 10px 0; }
        .player-hand { display: flex; }
        .game-state { margin: 20px 0; }
        .bet-controls { margin: 20px 0; }
    </style>
</head>
<body>
    <h1>Poker Game</h1>
    <button id="deal-cards">Deal Cards</button>
    <div class="bet-controls hidden" id="bet-controls">
        <input type="number" id="bet-amount" placeholder="Bet Amount">
        <button id="place-bet">Place Bet</button>
    </div>
    <button id="determine-winner">Determine Winner</button>
    <div class="game-state" id="game-state"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const socket = io.connect();
            const username = "{{ username }}";

            socket.on('connect', () => {
                console.log('Connected to the poker game server.');
                socket.emit('join_poker_game');
            });

            socket.on('game_state', (data) => {
                updateGameState(data);
            });

            document.getElementById('deal-cards').addEventListener('click', () => {
                socket.emit('deal_cards');
            });

            document.getElementById('place-bet').addEventListener('click', () => {
                const amount = document.getElementById('bet-amount').value;
                socket.emit('place_bet', { amount: parseInt(amount, 10) });
            });

            document.getElementById('determine-winner').addEventListener('click', () => {
                socket.emit('determine_winner');
            });

            function updateGameState(data) {
                const gameStateEl = document.getElementById('game-state');
                gameStateEl.innerHTML = '';

                const potEl = document.createElement('div');
                potEl.innerHTML = `<strong>Pot:</strong> ${data.pot}`;
                gameStateEl.appendChild(potEl);

                const currentBetEl = document.createElement('div');
                currentBetEl.innerHTML = `<strong>Current Bet:</strong> ${data.current_bet}`;
                gameStateEl.appendChild(currentBetEl);

                const playerTurnEl = document.createElement('div');
                playerTurnEl.innerHTML = `<strong>Player Turn:</strong> ${data.player_turn}`;
                gameStateEl.appendChild(playerTurnEl);

                const communityCardsEl = document.createElement('div');
                communityCardsEl.innerHTML = '<strong>Community Cards:</strong>';
                data.community_cards.forEach(card => {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'card';
                    cardEl.innerHTML = `<span>${card}</span>`;
                    communityCardsEl.appendChild(cardEl);
                });
                gameStateEl.appendChild(communityCardsEl);

                const playersEl = document.createElement('div');
                playersEl.innerHTML = '<strong>Players:</strong>';
                for (const [player, info] of Object.entries(data.players)) {
                    const playerEl = document.createElement('div');
                    playerEl.className = 'player-info';
                    playerEl.innerHTML = `<strong>${player}</strong>: ${info.chips} chips, Current Bet: ${info.current_bet}`;
                    const handEl = document.createElement('div');
                    handEl.className = 'player-hand';
                    info.hand.forEach(card => {
                        const cardEl = document.createElement('div');
                        cardEl.className = 'card';
                        cardEl.innerHTML = `<span>${card}</span>`;
                        handEl.appendChild(cardEl);
                    });
                    playerEl.appendChild(handEl);
                    playersEl.appendChild(playerEl);
                }
                gameStateEl.appendChild(playersEl);

                const winnerEl = document.createElement('div');
                if (data.winner) {
                    winnerEl.innerHTML = `<strong>Winner:</strong> ${data.winner}`;
                } else {
                    winnerEl.innerHTML = '<strong>Winner:</strong> None';
                }
                gameStateEl.appendChild(winnerEl);

                if (data.player_turn === username) {
                    document.getElementById('bet-controls').classList.remove('hidden');
                } else {
                    document.getElementById('bet-controls').classList.add('hidden');
                }
            }
        });
    </script>
</body>
</html>
